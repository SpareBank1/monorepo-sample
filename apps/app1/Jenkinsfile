pipeline {
//    agent {
//         docker {
//             image 'docker.io/library/maven:3.6.1-jdk-8'
//         }
//     }

    agent any

    stages {
        stage('Condition stage') {
            when {
                allOf {
                    expression {
                        sh(returnStatus: true, script: 'git diff  origin/master --name-only | grep --quiet "^apps/app1/.*"') != 0
                    }
                    not { branch 'master' }
                }
            }
            steps {
                script {
                    currentBuild.result = 'ABORTED'
                    error("Aborting the build.")
                }
            }
        }

        stage('Build app1') {
            steps {
               sh 'mvn -f apps/app1/pom.xml clean install'
//                sh 'echo "Build app1"'
            }
        }

    }
}
